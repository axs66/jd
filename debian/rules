#!/usr/bin/make -f
# -*- makefile -*-

# 取消默认的 dh_auto_configure
override_dh_auto_configure:

# 定义安装路径
JS_INSTALL_DIR = /usr/share/jd-price
SERVICE_DIR = /lib/systemd/system

# 构建阶段
%:
	dh $@ --with=nodejs

# 自定义安装步骤
override_dh_auto_install:
	# 创建安装目录
	mkdir -p debian/jd-price$(JS_INSTALL_DIR)
	mkdir -p debian/jd-price$(SERVICE_DIR)
	
	# 复制主脚本
	install -m 755 src/jd_price.js debian/jd-price$(JS_INSTALL_DIR)/
	
	# 安装系统服务文件
	install -m 644 debian/jd-price.service debian/jd-price$(SERVICE_DIR)/
	
	# 生成可执行入口
	mkdir -p debian/jd-price/usr/bin
	echo '#!/bin/sh' > debian/jd-price/usr/bin/jd-price
	echo 'exec node $(JS_INSTALL_DIR)/jd_price.js "$$@"' >> debian/jd-price/usr/bin/jd-price
	chmod 755 debian/jd-price/usr/bin/jd-price

# 清理 Node.js 模块缓存
override_dh_auto_clean:
	rm -rf node_modules
	dh_auto_clean

# 跳过不必要的测试
override_dh_auto_test:
